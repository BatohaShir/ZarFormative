//////////////////////////////////////////////////////////////////////////////////////////////
// DO NOT MODIFY THIS FILE                                                                  //
// This file is automatically generated by ZenStack CLI and should not be manually updated. //
//////////////////////////////////////////////////////////////////////////////////////////////

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

generator client {
  provider = "prisma-client-js"
}

enum UserRole {
  admin
  manager
  user
}

enum ListingStatus {
  draft
  active
  paused
  archived
  deleted
}

enum RequestStatus {
  pending
  accepted
  rejected
  in_progress
  awaiting_client_confirmation
  awaiting_completion_details
  awaiting_payment
  completed
  cancelled_by_client
  cancelled_by_provider
  disputed
}

enum NotificationType {
  request_accepted
  request_rejected
  work_started
  work_awaiting_confirmation
  work_completed
  cancelled_by_provider
  request_expired
  new_request
  request_cancelled
  work_reminder
  client_confirmed_completion
  payment_received
  new_message
}

enum ServiceType {
  on_site
  remote
}

enum AimagType {
  aimag
  capital
}

enum DistrictType {
  duureg
  sum
}

model aimags {
  id         String             @id() @default(cuid())
  name       String             @unique()
  name_en    String?
  code       String             @unique()
  type       AimagType          @default(aimag)
  sort_order Int                @default(0)
  is_active  Boolean            @default(true)
  created_at DateTime           @default(now())
  updated_at DateTime           @updatedAt()
  districts  districts[]
  listings   listings[]
  requests   listing_requests[]

  @@index([type])
  @@index([is_active, sort_order])
  @@map("aimags")
}

model districts {
  id         String             @id() @default(cuid())
  aimag_id   String
  name       String
  name_en    String?
  type       DistrictType       @default(duureg)
  sort_order Int                @default(0)
  is_active  Boolean            @default(true)
  created_at DateTime           @default(now())
  updated_at DateTime           @updatedAt()
  aimag      aimags             @relation(fields: [aimag_id], references: [id], onDelete: Cascade)
  khoroos    khoroos[]
  listings   listings[]
  requests   listing_requests[]

  @@unique([aimag_id, name])
  @@index([aimag_id])
  @@index([aimag_id, is_active])
  @@index([type])
  @@map("districts")
}

model khoroos {
  id          String             @id() @default(cuid())
  district_id String
  name        String
  number      Int?
  sort_order  Int                @default(0)
  is_active   Boolean            @default(true)
  created_at  DateTime           @default(now())
  updated_at  DateTime           @updatedAt()
  district    districts          @relation(fields: [district_id], references: [id], onDelete: Cascade)
  listings    listings[]
  requests    listing_requests[]

  @@unique([district_id, name])
  @@unique([district_id, number])
  @@index([district_id])
  @@index([district_id, is_active])
  @@map("khoroos")
}

model categories {
  id         String       @id() @default(cuid())
  slug       String       @unique()
  name       String
  icon       String?
  parent_id  String?
  parent     categories?  @relation("CategoryHierarchy", fields: [parent_id], references: [id])
  children   categories[] @relation("CategoryHierarchy")
  sort_order Int          @default(0)
  is_active  Boolean      @default(true)
  created_at DateTime     @default(now())
  updated_at DateTime     @updatedAt()
  listings   listings[]

  @@index([parent_id])
  @@index([slug])
  @@index([is_active, sort_order])
  @@map("categories")
}

model profiles {
  id                      String                          @id() @db.Uuid()
  first_name              String?
  last_name               String?
  phone_number            String?
  is_company              Boolean                         @default(false)
  avatar_url              String?
  about                   String?
  role                    UserRole                        @default(user)
  created_at              DateTime                        @default(now())
  updated_at              DateTime                        @default(now())
  company_name            String?
  registration_number     String?
  is_deleted              Boolean                         @default(false)
  push_subscriptions      profiles_push_subscriptions[]
  notification_settings   profiles_notification_settings?
  educations              profiles_educations[]
  work_experiences        profiles_work_experiences[]
  listings                listings[]
  viewed_listings         listings_views[]
  favorites               user_favorites[]
  sent_requests           listing_requests[]              @relation("ClientRequests")
  received_requests       listing_requests[]              @relation("ProviderRequests")
  received_notifications  notifications[]                 @relation("NotificationRecipient")
  triggered_notifications notifications[]                 @relation("NotificationActor")
  chat_messages           chat_messages[]

  @@index([is_deleted])
  @@index([is_company])
  @@index([created_at])
  @@index([role])
  @@map("profiles")
}

model profiles_push_subscriptions {
  id         String    @id() @default(uuid()) @db.Uuid()
  user_id    String    @db.Uuid()
  endpoint   String
  p256dh     String?
  auth       String?
  expires_at DateTime?
  created_at DateTime  @default(now())
  updated_at DateTime  @default(now())
  profile    profiles  @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([user_id, endpoint])
  @@index([user_id])
  @@map("profiles_push_subscriptions")
}

model profiles_notification_settings {
  id                     String   @id() @default(uuid()) @db.Uuid()
  user_id                String   @unique() @db.Uuid()
  push_enabled           Boolean  @default(false)
  push_new_requests      Boolean  @default(true)
  push_new_messages      Boolean  @default(true)
  push_status_changes    Boolean  @default(true)
  email_enabled          Boolean  @default(true)
  email_new_requests     Boolean  @default(true)
  email_new_messages     Boolean  @default(true)
  email_digest           Boolean  @default(true)
  email_digest_frequency String   @default("daily")
  quiet_hours_enabled    Boolean  @default(false)
  quiet_hours_start      String   @default("22:00")
  quiet_hours_end        String   @default("08:00")
  created_at             DateTime @default(now())
  updated_at             DateTime @default(now())
  profile                profiles @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@map("profiles_notification_settings")
}

model profiles_educations {
  id             String    @id() @default(uuid()) @db.Uuid()
  user_id        String    @db.Uuid()
  degree         String
  institution    String
  field_of_study String?
  start_date     DateTime
  end_date       DateTime?
  is_current     Boolean   @default(false)
  created_at     DateTime  @default(now())
  updated_at     DateTime  @default(now())
  user           profiles  @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([user_id])
  @@index([user_id, start_date(sort: Desc)])
  @@index([user_id, is_current])
  @@index([user_id, is_current, start_date(sort: Desc)])
  @@map("profiles_educations")
}

model profiles_work_experiences {
  id          String    @id() @default(uuid()) @db.Uuid()
  user_id     String    @db.Uuid()
  company     String
  position    String
  description String?
  start_date  DateTime
  end_date    DateTime?
  is_current  Boolean   @default(false)
  created_at  DateTime  @default(now())
  updated_at  DateTime  @default(now())
  user        profiles  @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([user_id])
  @@index([user_id, start_date(sort: Desc)])
  @@index([user_id, is_current])
  @@index([user_id, is_current, start_date(sort: Desc)])
  @@map("profiles_work_experiences")
}

model listings {
  id               String                   @id() @default(cuid())
  user_id          String                   @db.Uuid()
  category_id      String?
  title            String
  slug             String                   @unique()
  description      String                   @db.Text()
  price            Decimal?                 @db.Decimal(12, 2)
  currency         String                   @default("MNT")
  is_negotiable    Boolean                  @default(false)
  duration_minutes Int?
  work_hours_start String?                  @default("09:00")
  work_hours_end   String?                  @default("18:00")
  service_type     ServiceType              @default(on_site)
  aimag_id         String?
  district_id      String?
  khoroo_id        String?
  address          String?
  latitude         Decimal?                 @db.Decimal(10, 7)
  longitude        Decimal?                 @db.Decimal(10, 7)
  status           ListingStatus            @default(draft)
  is_active        Boolean                  @default(true)
  views_count      Int                      @default(0)
  favorites_count  Int                      @default(0)
  search_vector    Unsupported("tsvector")?
  created_at       DateTime                 @default(now())
  updated_at       DateTime                 @updatedAt()
  published_at     DateTime?
  user             profiles                 @relation(fields: [user_id], references: [id], onDelete: Cascade)
  category         categories?              @relation(fields: [category_id], references: [id])
  aimag            aimags?                  @relation(fields: [aimag_id], references: [id])
  district         districts?               @relation(fields: [district_id], references: [id])
  khoroo           khoroos?                 @relation(fields: [khoroo_id], references: [id])
  images           listings_images[]
  views            listings_views[]
  favorites        user_favorites[]
  requests         listing_requests[]

  @@index([user_id])
  @@index([category_id])
  @@index([status, is_active])
  @@index([aimag_id])
  @@index([aimag_id, district_id])
  @@index([aimag_id, district_id, khoroo_id])
  @@index([created_at(sort: Desc)])
  @@index([status, aimag_id, category_id])
  @@index([slug])
  @@index([user_id, status, is_active])
  @@index([status, is_active, views_count(sort: Desc)])
  @@index([status, is_active, price])
  @@index([status, is_active, category_id, price])
  @@index([user_id, status, updated_at(sort: Desc)])
  @@index([status, is_active, published_at(sort: Desc)])
  @@index([status, is_active, favorites_count(sort: Desc)])
  @@map("listings")
}

model listings_images {
  id         String   @id() @default(uuid()) @db.Uuid()
  listing_id String
  url        String
  alt        String?
  sort_order Int      @default(0)
  is_cover   Boolean  @default(false)
  created_at DateTime @default(now())
  listing    listings @relation(fields: [listing_id], references: [id], onDelete: Cascade)

  @@index([listing_id])
  @@index([listing_id, sort_order])
  @@index([listing_id, is_cover])
  @@map("listings_images")
}

model listings_views {
  id         String    @id() @default(uuid()) @db.Uuid()
  listing_id String
  viewer_id  String?   @db.Uuid()
  ip_address String?
  viewed_at  DateTime  @default(now())
  listing    listings  @relation(fields: [listing_id], references: [id], onDelete: Cascade)
  viewer     profiles? @relation(fields: [viewer_id], references: [id], onDelete: SetNull)

  @@index([listing_id, viewed_at(sort: Desc)])
  @@index([listing_id, viewer_id, viewed_at(sort: Desc)])
  @@index([listing_id, ip_address, viewed_at(sort: Desc)])
  @@map("listings_views")
}

model user_favorites {
  id         String   @id() @default(uuid()) @db.Uuid()
  user_id    String   @db.Uuid()
  listing_id String
  created_at DateTime @default(now())
  user       profiles @relation(fields: [user_id], references: [id], onDelete: Cascade)
  listing    listings @relation(fields: [listing_id], references: [id], onDelete: Cascade)

  @@unique([user_id, listing_id])
  @@index([user_id, created_at(sort: Desc)])
  @@index([listing_id])
  @@map("user_favorites")
}

model listing_requests {
  id                     String          @id() @default(cuid())
  listing_id             String
  client_id              String          @db.Uuid()
  provider_id            String          @db.Uuid()
  message                String          @db.Text()
  status                 RequestStatus   @default(pending)
  aimag_id               String?
  district_id            String?
  khoroo_id              String?
  address_detail         String?
  preferred_date         DateTime?
  preferred_time         String?
  note                   String?         @db.Text()
  image_url              String?
  provider_response      String?         @db.Text()
  completion_description String?         @db.Text()
  completion_photos      String[]        @default([])
  created_at             DateTime        @default(now())
  updated_at             DateTime        @updatedAt()
  accepted_at            DateTime?
  completed_at           DateTime?
  listing                listings        @relation(fields: [listing_id], references: [id], onDelete: Cascade)
  client                 profiles        @relation("ClientRequests", fields: [client_id], references: [id], onDelete: Cascade)
  provider               profiles        @relation("ProviderRequests", fields: [provider_id], references: [id], onDelete: Cascade)
  aimag                  aimags?         @relation(fields: [aimag_id], references: [id])
  district               districts?      @relation(fields: [district_id], references: [id])
  khoroo                 khoroos?        @relation(fields: [khoroo_id], references: [id])
  notifications          notifications[]
  chat_messages          chat_messages[]
  review                 reviews?

  @@index([listing_id])
  @@index([client_id, status])
  @@index([provider_id, status])
  @@index([client_id, created_at(sort: Desc)])
  @@index([provider_id, created_at(sort: Desc)])
  @@index([status, created_at(sort: Desc)])
  @@index([provider_id, preferred_date, status])
  @@map("listing_requests")
}

model notifications {
  id         String            @id() @default(cuid())
  user_id    String            @db.Uuid()
  type       NotificationType
  title      String
  message    String            @db.Text()
  is_read    Boolean           @default(false)
  request_id String?
  actor_id   String?           @db.Uuid()
  created_at DateTime          @default(now())
  read_at    DateTime?
  user       profiles          @relation("NotificationRecipient", fields: [user_id], references: [id], onDelete: Cascade)
  actor      profiles?         @relation("NotificationActor", fields: [actor_id], references: [id], onDelete: SetNull)
  request    listing_requests? @relation(fields: [request_id], references: [id], onDelete: SetNull)

  @@index([user_id, is_read, created_at(sort: Desc)])
  @@index([user_id, created_at(sort: Desc)])
  @@index([request_id])
  @@map("notifications")
}

model chat_messages {
  id              String           @id() @default(cuid())
  request_id      String
  sender_id       String           @db.Uuid()
  message         String           @db.Text()
  is_read         Boolean          @default(false)
  created_at      DateTime         @default(now())
  read_at         DateTime?
  attachment_type String?
  attachment_url  String?
  location_lat    Decimal?         @db.Decimal(10, 7)
  location_lng    Decimal?         @db.Decimal(10, 7)
  location_name   String?
  request         listing_requests @relation(fields: [request_id], references: [id], onDelete: Cascade)
  sender          profiles         @relation(fields: [sender_id], references: [id], onDelete: Cascade)

  @@index([request_id, created_at(sort: Desc)])
  @@index([sender_id])
  @@index([request_id, is_read])
  @@map("chat_messages")
}

model reviews {
  id          String           @id() @default(cuid())
  request_id  String           @unique()
  client_id   String           @db.Uuid()
  provider_id String           @db.Uuid()
  rating      Int
  comment     String?          @db.Text()
  created_at  DateTime         @default(now())
  request     listing_requests @relation(fields: [request_id], references: [id], onDelete: Cascade)

  @@index([provider_id, created_at(sort: Desc)])
  @@index([client_id])
  @@map("reviews")
}
